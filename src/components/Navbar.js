import IconButton from '@mui/material/IconButton';
import Stack from '@mui/material/Stack';
import LinkedInIcon from '@mui/icons-material/LinkedIn';
import { useTheme } from "@mui/material";
import { Link, useMatch, useResolvedPath } from "react-router-dom"

import DarkModeIcon from '@mui/icons-material/DarkMode';
import LightModeIcon from '@mui/icons-material/LightMode';
import { ColorModeContext } from "../styles/theme/colorModeContext";

import { useContext, useRef, useEffect, useState } from "react";


function Navbar() {

  const theme = useTheme();
  const colorMode = useContext(ColorModeContext);

  const navRef = useRef(null);
  const subnavRef = useRef(null);
  const [navHeight, setNavHeight] = useState(window.innerWidth * 0.075);

  // Função para calcular e definir a altura da navbar
  const updateNavHeight = () => {
    if (navRef.current) {
      const newHeight = window.innerWidth * 0.075; // Altura baseada na largura da janela
      setNavHeight(newHeight);
    }
  };

  useEffect(() => {
    updateNavHeight(); // Atualiza a altura ao montar o componente
    window.addEventListener('resize', updateNavHeight); // Adiciona o listener para resize

    return () => {
      window.removeEventListener('resize', updateNavHeight); // Limpa o listener ao desmontar
    };
  }, []);

  // Scroll event handler and cleanup on component unmount
  useEffect(() => {
    const handleScroll = () => {
      if (window.scrollY > 80) {
        navRef.current.classList.add("scrolled");
        subnavRef.current.classList.add("subScrolled");
        setNavHeight(65); // Define altura como 65px se o scroll for maior que 50px
      } else {
        navRef.current.classList.remove("scrolled");
        subnavRef.current.classList.remove("subScrolled");

        updateNavHeight(); // Volta a calcular a altura original

      }
    };

    window.addEventListener("scroll", handleScroll);

    return () => {
      window.removeEventListener("scroll", handleScroll);
    };
  }, []);

  return (
    <>
      <nav ref={navRef} id='navbar' style={{ position: "fixed", top: 0, gridColumnStart: 1, gridColumnEnd: 5, width: 'calc(100% - 60px)', display: "grid", gridTemplateColumns: "25% 25% 25% 25%", padding: "15px 0", borderBottom: `1px solid ${theme.palette.border}`, backgroundColor: theme.palette.background, height: `${navHeight}px`, transition: "height 1s ease", zIndex: "10" }}>
        <svg style={{ gridColumnStart: 1, gridRowStart: 1, width: "auto", height: `${navHeight - 30}px`, transition: "height 1s ease" }} width="90%" height="220" viewBox="0 0 806 220" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMid">
          <path d="M78.3 219.6C63.1 219.6 49.6 216.2 37.8 209.4C26 202.6 16.7 193.3 9.9 181.5C3.3 169.7 2.23517e-07 156.2 2.23517e-07 141C2.23517e-07 125.4 3.3 111.7 9.9 99.9C16.7 87.9 26 78.5 37.8 71.7C49.6 64.7 63.2 61.2 78.6 61.2C98 61.2 114.3 66.4 127.5 76.8C140.9 87 149.4 101.1 153 119.1H108.3C106.7 112.3 103.1 107 97.5 103.2C92.1 99.2 85.6 97.2 78 97.2C71.2 97.2 65.1 99 59.7 102.6C54.5 106 50.4 110.9 47.4 117.3C44.4 123.7 42.9 131.4 42.9 140.4C42.9 147.2 43.7 153.3 45.3 158.7C47.1 163.9 49.5 168.4 52.5 172.2C55.7 176 59.5 178.9 63.9 180.9C68.3 182.9 73 183.9 78 183.9C83.2 183.9 87.8 183.1 91.8 181.5C95.8 179.7 99.3 177.2 102.3 174C105.3 170.6 107.3 166.6 108.3 162H153C149.4 179.6 140.9 193.6 127.5 204C114.1 214.4 97.7 219.6 78.3 219.6ZM223.905 219.6C211.505 219.6 201.105 217.6 192.705 213.6C184.505 209.4 178.405 203.9 174.405 197.1C170.605 190.1 168.705 182.4 168.705 174C168.705 165 171.005 157 175.605 150C180.205 143 187.305 137.5 196.905 133.5C206.505 129.5 218.505 127.5 232.905 127.5H270.105C270.105 120.3 269.105 114.4 267.105 109.8C265.305 105 262.305 101.4 258.105 99C254.105 96.6 248.705 95.4 241.905 95.4C234.505 95.4 228.205 97 223.005 100.2C218.005 103.4 214.905 108.2 213.705 114.6H172.905C174.105 103.8 177.705 94.5 183.705 86.7C189.705 78.7 197.705 72.5 207.705 68.1C217.905 63.5 229.405 61.2 242.205 61.2C256.405 61.2 268.705 63.6 279.105 68.4C289.705 73.2 297.805 80.1 303.405 89.1C309.205 98.1 312.105 109.2 312.105 122.4V216H276.705L271.905 193.2C269.905 197.2 267.305 200.8 264.105 204C261.105 207.2 257.605 210 253.605 212.4C249.605 214.6 245.105 216.3 240.105 217.5C235.305 218.9 229.905 219.6 223.905 219.6ZM234.105 187.2C239.105 187.2 243.605 186.4 247.605 184.8C251.605 183 255.005 180.5 257.805 177.3C260.605 174.1 262.905 170.5 264.705 166.5C266.505 162.3 267.705 157.8 268.305 153V152.7H238.005C232.205 152.7 227.405 153.5 223.605 155.1C220.005 156.5 217.305 158.6 215.505 161.4C213.705 164 212.805 167 212.805 170.4C212.805 174 213.705 177.1 215.505 179.7C217.305 182.3 219.805 184.2 223.005 185.4C226.205 186.6 229.905 187.2 234.105 187.2ZM334.859 216V64.8H372.059L375.959 92.7C379.759 86.1 384.359 80.5 389.759 75.9C395.159 71.3 401.459 67.7 408.659 65.1C415.859 62.5 423.659 61.2 432.059 61.2V105.6H417.959C411.959 105.6 406.359 106.3 401.159 107.7C396.159 109.1 391.759 111.4 387.959 114.6C384.359 117.6 381.559 121.8 379.559 127.2C377.759 132.4 376.859 139 376.859 147V216H334.859ZM443.784 216V-8.58307e-06H485.784V216H443.784ZM581.93 219.6C567.53 219.6 554.53 216.3 542.93 209.7C531.33 202.9 522.13 193.5 515.33 181.5C508.73 169.5 505.43 155.9 505.43 140.7C505.43 125.1 508.73 111.3 515.33 99.3C522.13 87.3 531.33 78 542.93 71.4C554.53 64.6 567.63 61.2 582.23 61.2C596.83 61.2 609.93 64.6 621.53 71.4C633.13 78 642.23 87.3 648.83 99.3C655.63 111.1 659.03 124.8 659.03 140.4C659.03 156 655.63 169.8 648.83 181.8C642.03 193.6 632.83 202.9 621.23 209.7C609.83 216.3 596.73 219.6 581.93 219.6ZM581.93 183.3C588.53 183.3 594.33 181.7 599.33 178.5C604.33 175.3 608.33 170.5 611.33 164.1C614.53 157.7 616.13 149.8 616.13 140.4C616.13 131 614.63 123.1 611.63 116.7C608.63 110.3 604.53 105.5 599.33 102.3C594.33 99.1 588.63 97.5 582.23 97.5C576.03 97.5 570.33 99.1 565.13 102.3C559.93 105.5 555.83 110.3 552.83 116.7C549.83 123.1 548.33 131 548.33 140.4C548.33 149.8 549.83 157.7 552.83 164.1C555.83 170.5 559.83 175.3 564.83 178.5C570.03 181.7 575.73 183.3 581.93 183.3ZM741.021 219.6C727.021 219.6 714.921 217.4 704.721 213C694.521 208.4 686.521 202.3 680.721 194.7C674.921 186.9 671.521 178.1 670.521 168.3H712.521C713.321 171.9 714.821 175.2 717.021 178.2C719.421 181 722.521 183.3 726.321 185.1C730.321 186.9 735.021 187.8 740.421 187.8C745.621 187.8 749.821 187.1 753.021 185.7C756.421 184.1 758.921 182.1 760.521 179.7C762.321 177.3 763.221 174.7 763.221 171.9C763.221 167.9 762.021 164.8 759.621 162.6C757.221 160.4 753.721 158.6 749.121 157.2C744.521 155.8 739.021 154.5 732.621 153.3C725.421 151.7 718.321 149.9 711.321 147.9C704.521 145.9 698.321 143.3 692.721 140.1C687.321 136.7 683.021 132.5 679.821 127.5C676.621 122.5 675.021 116.3 675.021 108.9C675.021 99.9 677.421 91.8 682.221 84.6C687.221 77.4 694.321 71.7 703.521 67.5C712.921 63.3 724.121 61.2 737.121 61.2C755.521 61.2 770.021 65.4 780.621 73.8C791.421 82 797.821 93.2 799.821 107.4H760.221C759.221 103 756.721 99.6 752.721 97.2C748.721 94.8 743.421 93.6 736.821 93.6C730.021 93.6 724.721 94.8 720.921 97.2C717.321 99.6 715.521 102.8 715.521 106.8C715.521 109.4 716.721 111.8 719.121 114C721.521 116 724.921 117.8 729.321 119.4C733.921 120.8 739.521 122.2 746.121 123.6C757.921 126 768.221 128.8 777.021 132C785.821 135 792.721 139.4 797.721 145.2C802.721 150.8 805.221 159 805.221 169.8C805.421 179.4 802.821 188 797.421 195.6C792.221 203.2 784.821 209.1 775.221 213.3C765.621 217.5 754.221 219.6 741.021 219.6Z" fill={theme.palette.text.primary} />
        </svg>
        <svg style={{ gridColumnStart: 2, gridRowStart: 1, width: "auto", height: `${navHeight - 30}px`, transition: "height 1s ease" }} width="76%" height="220" viewBox="0 0 676 220" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M55.8 219.6C43.4 219.6 33 217.6 24.6 213.6C16.4 209.4 10.3 203.9 6.3 197.1C2.5 190.1 0.6 182.4 0.6 174C0.6 165 2.9 157 7.5 150C12.1 143 19.2 137.5 28.8 133.5C38.4 129.5 50.4 127.5 64.8 127.5H102C102 120.3 101 114.4 99 109.8C97.2 105 94.2 101.4 90 99C86 96.6 80.6 95.4 73.8 95.4C66.4 95.4 60.1 97 54.9 100.2C49.9 103.4 46.8 108.2 45.6 114.6H4.8C6 103.8 9.6 94.5 15.6 86.7C21.6 78.7 29.6 72.5 39.6 68.1C49.8 63.5 61.3 61.2 74.1 61.2C88.3 61.2 100.6 63.6 111 68.4C121.6 73.2 129.7 80.1 135.3 89.1C141.1 98.1 144 109.2 144 122.4V216H108.6L103.8 193.2C101.8 197.2 99.2 200.8 96 204C93 207.2 89.5 210 85.5 212.4C81.5 214.6 77 216.3 72 217.5C67.2 218.9 61.8 219.6 55.8 219.6ZM66 187.2C71 187.2 75.5 186.4 79.5 184.8C83.5 183 86.9 180.5 89.7 177.3C92.5 174.1 94.8 170.5 96.6 166.5C98.4 162.3 99.6 157.8 100.2 153V152.7H69.9C64.1 152.7 59.3 153.5 55.5 155.1C51.9 156.5 49.2 158.6 47.4 161.4C45.6 164 44.7 167 44.7 170.4C44.7 174 45.6 177.1 47.4 179.7C49.2 182.3 51.7 184.2 54.9 185.4C58.1 186.6 61.8 187.2 66 187.2ZM166.753 216V-8.58307e-06H208.753V216H166.753ZM273.098 216L218.198 64.8H262.298L298.898 176.4L335.798 64.8H379.298L324.398 216H273.098ZM454.868 219.6C439.668 219.6 426.168 216.4 414.368 210C402.768 203.4 393.668 194.3 387.068 182.7C380.468 170.9 377.168 157.3 377.168 141.9C377.168 126.3 380.368 112.5 386.768 100.5C393.368 88.3 402.468 78.7 414.068 71.7C425.868 64.7 439.568 61.2 455.168 61.2C470.168 61.2 483.268 64.5 494.468 71.1C505.868 77.7 514.668 86.6 520.868 97.8C527.268 109 530.468 121.9 530.468 136.5C530.468 138.5 530.368 140.7 530.168 143.1C530.168 145.5 529.968 148.1 529.568 150.9H407.168V125.4H487.868C487.268 116.2 483.868 108.9 477.668 103.5C471.668 97.9 464.168 95.1 455.168 95.1C448.368 95.1 442.168 96.7 436.568 99.9C430.968 103.1 426.568 107.8 423.368 114C420.168 120.2 418.568 128.1 418.568 137.7V146.4C418.568 154.2 420.068 161.1 423.068 167.1C426.068 172.9 430.268 177.4 435.668 180.6C441.068 183.8 447.368 185.4 454.568 185.4C461.768 185.4 467.668 183.9 472.268 180.9C477.068 177.9 480.668 174 483.068 169.2H525.968C523.168 178.6 518.368 187.1 511.568 194.7C504.968 202.3 496.868 208.4 487.268 213C477.668 217.4 466.868 219.6 454.868 219.6ZM610.709 219.6C596.709 219.6 584.609 217.4 574.409 213C564.209 208.4 556.209 202.3 550.409 194.7C544.609 186.9 541.209 178.1 540.209 168.3H582.209C583.009 171.9 584.509 175.2 586.709 178.2C589.109 181 592.209 183.3 596.009 185.1C600.009 186.9 604.709 187.8 610.109 187.8C615.309 187.8 619.509 187.1 622.709 185.7C626.109 184.1 628.609 182.1 630.209 179.7C632.009 177.3 632.909 174.7 632.909 171.9C632.909 167.9 631.709 164.8 629.309 162.6C626.909 160.4 623.409 158.6 618.809 157.2C614.209 155.8 608.709 154.5 602.309 153.3C595.109 151.7 588.009 149.9 581.009 147.9C574.209 145.9 568.009 143.3 562.409 140.1C557.009 136.7 552.709 132.5 549.509 127.5C546.309 122.5 544.709 116.3 544.709 108.9C544.709 99.9 547.109 91.8 551.909 84.6C556.909 77.4 564.009 71.7 573.209 67.5C582.609 63.3 593.809 61.2 606.809 61.2C625.209 61.2 639.709 65.4 650.309 73.8C661.109 82 667.509 93.2 669.509 107.4H629.909C628.909 103 626.409 99.6 622.409 97.2C618.409 94.8 613.109 93.6 606.509 93.6C599.709 93.6 594.409 94.8 590.609 97.2C587.009 99.6 585.209 102.8 585.209 106.8C585.209 109.4 586.409 111.8 588.809 114C591.209 116 594.609 117.8 599.009 119.4C603.609 120.8 609.209 122.2 615.809 123.6C627.609 126 637.909 128.8 646.709 132C655.509 135 662.409 139.4 667.409 145.2C672.409 150.8 674.909 159 674.909 169.8C675.109 179.4 672.509 188 667.109 195.6C661.909 203.2 654.509 209.1 644.909 213.3C635.309 217.5 623.909 219.6 610.709 219.6Z" fill={theme.palette.text.primary} />
        </svg>

        <div>
          <Stack direction="row" spacing={1}>
            <a style={{ textDecoration: "none" }} href='https://www.linkedin.com/in/carlosjalves99/' target="_blank" rel="noopener noreferrer">
              <IconButton size={'small'} sx={{ color: theme.palette.text.primary }}>
                <LinkedInIcon />
              </IconButton>
            </a>
          </Stack>
        </div>

        <IconButton size={'small'} sx={(theme) => ({ color: theme.palette.text.primary, height: "fit-content", justifySelf: "end" })} onClick={colorMode.toggleColorMode}>
          {theme.palette.mode === "dark" ? <LightModeIcon /> : <DarkModeIcon />}
        </IconButton>
      </nav>

      <nav ref={subnavRef} id='subnavbar' style={{ position: "fixed", top: `${navHeight}px`, display: "grid", gridTemplateColumns: "25% 25% 25% 25%", width: 'calc(100% - 60px)', backgroundColor: theme.palette.background, borderBottom: `1px solid ${theme.palette.border}`, transition: "top 1s ease, padding 0.7s ease", zIndex: "10" }}>
        <div style={{ gridColumnStart: 1, lineHeight: "13px" }}>
          <p style={{ color: theme.palette.text.secondary }}>Designer</p>
          <p style={{ color: theme.palette.text.secondary }}>Developer</p>
        </div>

        <div style={{ gridColumnStart: 2, lineHeight: "13px" }}>
          <CustomLink to={"/about"} theme={theme}><p>About</p></CustomLink>
          <CustomLink to={"/"} theme={theme}><p>Work</p></CustomLink>
        </div>
      </nav>
    </>
  );
}

function CustomLink({ to, children, theme }) {

  const path = useResolvedPath(to)
  const isActive = useMatch({ path: path.pathname })

  return (
    <Link to={to} style={{ color: isActive ? theme.palette.text.primary : theme.palette.text.secondary }}>{children}</Link>
  )
}

export default Navbar;
